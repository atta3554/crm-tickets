<div class="ctm-container">
    <div class="ctm-container-inner">

        <div class="ctm-section-title">
            <h3 class="title">تیکت‌های پشتیبانی</h3>
        </div>

        <div class="ctm-section-container">
            <div class="section-container-inner">

                <div class="ctm-section-header">
                    <div class="section-header-inner">
                        <h4 class="header-title">همه تیکت‌ها</h4>
                        <a href="" class="crm-new-ticket">ارسال تیکت جدید</a>
                    </div>
                </div>

                <div class="ctm-tickets-status">
                    <div class="tickets-status-inner">
                        <?php foreach($this->tickets_statuses as $status=>$ticket) : ?>
                        <div class="ticket-status <?= $status ?>">
                            <div class="ticket-status-inner">
                                <div class="status-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" id="Capa_1" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" class=""><g><g><path d="m346.5 213.5c4.143 0 7.5-3.358 7.5-7.5v-25c0-4.142-3.357-7.5-7.5-7.5s-7.5 3.358-7.5 7.5v25c0 4.142 3.357 7.5 7.5 7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m339 267c0 4.142 3.357 7.5 7.5 7.5s7.5-3.358 7.5-7.5v-23c0-4.142-3.357-7.5-7.5-7.5s-7.5 3.358-7.5 7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m339 330c0 4.142 3.357 7.5 7.5 7.5s7.5-3.358 7.5-7.5v-24c0-4.142-3.357-7.5-7.5-7.5s-7.5 3.358-7.5 7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m496.86 214.184c8.772-1.59 15.14-9.238 15.14-18.186v-69.998c0-15.164-12.337-27.5-27.5-27.5h-111c-10.926 0-20.674 5.111-27 13.061-6.326-7.95-16.074-13.061-27-13.061h-217.5c-4.143 0-7.5 3.358-7.5 7.5s3.357 7.5 7.5 7.5h217.5c10.752 0 19.5 8.748 19.5 19.5v11.988c0 4.142 3.357 7.5 7.5 7.5s7.5-3.358 7.5-7.5v-11.988c0-10.752 8.748-19.5 19.5-19.5h111c6.893 0 12.5 5.607 12.5 12.5v69.998c0 1.69-1.184 3.131-2.815 3.426-27.341 4.956-47.185 28.75-47.185 56.576s19.844 51.62 47.185 56.576c1.632.295 2.815 1.736 2.815 3.426v29.498c0 4.142 3.357 7.5 7.5 7.5s7.5-3.358 7.5-7.5v-29.498c0-8.948-6.367-16.596-15.14-18.186-20.199-3.661-34.86-21.248-34.86-41.816s14.661-38.155 34.86-41.816z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m504.5 373c-4.143 0-7.5 3.358-7.5 7.5v5.5c0 6.893-5.607 12.5-12.5 12.5h-111c-10.752 0-19.5-8.748-19.5-19.5 0-3.088 0-9.976 0-13 0-4.142-3.357-7.5-7.5-7.5s-7.5 3.358-7.5 7.5v13c0 10.752-8.748 19.5-19.5 19.5h-292c-6.893 0-12.5-5.607-12.5-12.5v-69.998c0-1.689 1.184-3.131 2.815-3.426 27.341-4.956 47.185-28.75 47.185-56.576s-19.844-51.62-47.185-56.576c-1.632-.295-2.815-1.737-2.815-3.426v-69.998c0-6.893 5.607-12.5 12.5-12.5h39.5c4.143 0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5h-39.5c-15.163 0-27.5 12.336-27.5 27.5v69.998c0 8.947 6.367 16.596 15.14 18.186 20.199 3.661 34.86 21.248 34.86 41.816s-14.661 38.155-34.86 41.816c-8.773 1.591-15.14 9.239-15.14 18.186v69.998c0 15.164 12.337 27.5 27.5 27.5h292c10.926 0 20.674-5.111 27-13.061 6.326 7.95 16.074 13.061 27 13.061h111c15.163 0 27.5-12.336 27.5-27.5v-5.5c0-4.142-3.357-7.5-7.5-7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m108 256c0 4.142 3.357 7.5 7.5 7.5h169c4.143 0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5h-169c-4.143 0-7.5 3.358-7.5 7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m115.5 323.5h81.5c4.143 0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5h-81.5c-4.143 0-7.5 3.358-7.5 7.5s3.357 7.5 7.5 7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m248.5 203.5c4.143 0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5h-97c-4.143 0-7.5 3.358-7.5 7.5s3.357 7.5 7.5 7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/><path d="m284.5 308.5h-42.5c-4.143 0-7.5 3.358-7.5 7.5s3.357 7.5 7.5 7.5h42.5c4.143 0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5z" data-original="#000000" class="active-path" style="fill:#707070" data-old_color="#000000"/></g></g></svg>
                                    <span class="status-color"></span>
                                </div>
                                <div class="status-name"><?= esc_html($ticket['status']) ?></div>
                                <div class="status-count status-color"><?= esc_html($ticket['count']) ?></div>
                            </div>
                        </div>
                        <?php endforeach; ?>
                    </div>
                </div>

                <div class="ctm-filters-container">
                    <div class="filters-container-inner">
                        <span class="tickets-total-count">نمایش <?= $this->tickets_statuses['all']['count'] ?> تیکت</span>
                        <div class="tickets-filters">
                            <div class="tickets-filters-inner">
                                <?php foreach($this->filters as $type=>$filters) : ?>
                                <select name="<?= $type ?>" class="<?= $type ?>-filter">
                                    <?php foreach($filters as $status=>$val) : ?>
                                        <option value="<?= $status ?>"><?php echo $val['status']; if($type != 'by_date') echo ' (' . $val['count'] . ')'; ?></option>
                                    <?php endforeach; ?>
                                </select>
                                <?php endforeach; ?>
                                <button class="submit-filters">صافی</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ctm-tickets-list">
                    <div class="tickets-list-inner">
                    <?php if(isset($fetched_tickets) AND !empty($fetched_tickets)) : ?>
                        <?php foreach($fetched_tickets as $ticket) : ?>
                        <div class="ctm-ticket-item ticket-item-<?= esc_attr($ticket['id']) . ' ' . esc_attr($ticket['status']) ?>" id="ctm-ticket-<?=esc_attr($ticket['id'])?>">
                            <div class="ticket-item-inner">

                                <div class="ctm-item-title">
                                    <div class="item-title-inner">
                                        <a href="<?= site_url() . '/my-tickets/ticket-' ?>" class="ctm-ticket-title"><?= esc_html($ticket['title']) ?></a>
                                        <div class="ticket-id">
                                            <svg xmlns="http://www.w3.org/2000/svg" id="Capa_1" enable-background="new 0 0 515.555 515.555" height="512" viewBox="0 0 515.555 515.555" width="512"><g><path d="m303.347 18.875c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138c25.166-25.167 65.97-25.167 91.138 0" data-original="#000000" class="active-path" style="fill:#8D99A9" data-old_color="#000000"/><path d="m303.347 212.209c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138c25.166-25.167 65.97-25.167 91.138 0" data-original="#000000" class="active-path" style="fill:#8D99A9" data-old_color="#000000"/><path d="m303.347 405.541c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138c25.166-25.167 65.97-25.167 91.138 0" data-original="#000000" class="active-path" style="fill:#8D99A9" data-old_color="#000000"/></g></svg>
                                            شماره تیکت:‌<span><?= esc_html($ticket['id']) ?></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="ctm-item-support">
                                    <div class="item-support-inner">
                                        <div class="support-img <?=esc_attr($ticket['support-id'])?>"></div>
                                        <span class="support-name"><?=$ticket['support']?></span>
                                        <div class="has-notification">
                                            <?php if($ticket['is_read'] === false) echo '<span></span>'; ?>
                                            <svg xmlns="http://www.w3.org/2000/svg" id="Outlined" viewBox="0 0 32 32"><title/><g id="Fill"><path d="M26,3H6A3,3,0,0,0,3,6V30.41l5.12-5.12A1.05,1.05,0,0,1,8.83,25H26a3,3,0,0,0,3-3V6A3,3,0,0,0,26,3Zm1,19a1,1,0,0,1-1,1H8.83a3,3,0,0,0-2.12.88L5,25.59V6A1,1,0,0,1,6,5H26a1,1,0,0,1,1,1Z"/><rect height="2" width="12" x="10" y="11"/><rect height="2" width="7" x="10" y="15"/></g></svg>
                                        </div>
                                    </div>
                                </div>

                                <div class="ctm-ticket-importance">
                                    <div class="ticket-importance-inner">
                                        <div>اهمیت:‌ <span><?=$ticket['importance_name']?></span></div>
                                        <div class="ctm-rating"><?php for($i=0; $i<intval($ticket['importance']); $i++) :?><span></span><?php endfor; ?></div>
                                    </div>
                                </div>

                                <div class="ctm-ticket-status">
                                    <div class="ticket-status-inner <?=esc_attr($ticket['status'])?>">
                                        <span class="status-color"></span>
                                        <span class="ticket-status"><?=esc_html($this->tickets_statuses[$ticket['status']]['status'])?></span>
                                    </div>
                                </div>

                                <div class="ctm-ticket-date">
                                    <div class="ticket-date-inner">
                                        <span class="ticket-answered-date" dir="ltr"><?=$ticket['date']?></span>
                                        <div class="ticket-created-date" title="<?=esc_attr($ticket['modified'])?>">آخرین اقدام:  <span><?=esc_html($ticket['modified_status'])?></span></div>
                                    </div>
                                </div>

                                <div class="ctm-view-ticket">
                                    <div class="view-ticket-inner">
                                        <a href="<?= esc_url(site_url() . '/my-tickets/ticket-' . $ticket['id']) ?>" class="btn view-ticket-">مشاهده تیکت</a>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <?php endforeach; ?>
                    <?php endif; ?>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>